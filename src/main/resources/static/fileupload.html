<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>文件上传demo</title>
    <!-- jQuery文件。务必在bootstrap.min.js 之前引入 -->
    <script src="js/jquery.min.js" charset="utf-8"></script>
    <style>
        .aaa{
            background-color: #1697d3;
        }
    </style>

</head>
<body>

</body>
<fieldset>
    <legend>文件上传</legend>
    file:<input id="file" type="file" name="file">
    <input id="uploadbutton" type="button" value="Upload"/>
</fieldset>
<fieldset>
    <legend>结果</legend>
    <div id="aaa" class="aaa"></div>
</fieldset>
<fieldset>
    <legend>缩略图</legend>
    <img id="iconImg" src="" />
</fieldset>
<fieldset>
    <legend>原图</legend>
    <img id="img" src="" />
</fieldset>
<fieldset>
    <legend>上传前</legend>
    <img id="preImg" src="" />
</fieldset>
<script>
    $(function () {
        var filename = null;
        var filesize = 0;
        var filetype = null;
        var base64 = null;

        $('#uploadbutton').click(function(){
            if(!base64){
                alert("请选择文件");
                return;
            }
            document.getElementById("preImg").src = base64;
            alert([filename, filesize, filetype].join(","));
            var url = "http://120.76.53.1:9102/public/uploadImg";
            $.ajax({
                url: url,
                type: 'POST', //GET
                async: true,    //或false,是否异步
                data: {"base64": base64},
                timeout: 5000,    //超时时间
                dataType: 'json',    //返回的数据格式：json/xml/html/script/jsonp/text
                beforeSend: function (xhr) {
                    console.log(xhr);
                    console.log('发送前');
                },
                success: function (data, textStatus, jqXHR) {
                    console.log(data);
                    console.log(textStatus);
                    console.log(jqXHR);
                    document.getElementById("aaa").innerText = JSON.stringify(data);
                    if(data.retCode == 1){
                        var _data = data.data;
                        document.getElementById("iconImg").src = _data.iconPath;
                        document.getElementById("img").src = _data.imgPath;
                    }
                },
                error: function (xhr, textStatus) {
                    console.log('错误');
                    console.log(xhr);
                    console.log(textStatus);
                },
                complete: function () {
                    console.log('结束');
                }
            })
        });

        $('#file').change(function(){
            var file = this.files[0];
            filename = file.name;
            filesize = file.size;
            filetype = file.type;

            var reader = new FileReader();//new一个FileReader实例
            if(/image\/\w+/.test(file.type)) {
                reader.onload = function() {
                    base64 = reader.result;
                }
            } else{
                alert("请选择图片类型");
            }
            reader.readAsDataURL(file);
        });
    });
</script>
</html>