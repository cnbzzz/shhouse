<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.jufangbao.house.shhouse.mapper.TCmAgentMessageMapper">
  <resultMap id="BaseResultMap" type="cn.jufangbao.house.shhouse.model.TCmAgentMessage">
    <!--
      WARNING - @mbg.generated
    -->
    <id column="oid" jdbcType="VARCHAR" property="oid" />
    <result column="fromUserId" jdbcType="VARCHAR" property="fromuserid" />
    <result column="fromUserType" jdbcType="VARCHAR" property="fromusertype" />
    <result column="toUserId" jdbcType="VARCHAR" property="touserid" />
    <result column="toUserType" jdbcType="VARCHAR" property="tousertype" />
    <result column="content" jdbcType="VARCHAR" property="content" />
    <result column="createTime" jdbcType="TIMESTAMP" property="createtime" />
    <result column="msgType" jdbcType="VARCHAR" property="msgtype" />
    <result column="status" jdbcType="INTEGER" property="status" />
  </resultMap>

  <select id="countUnreadMessageByToUserId" parameterType="String" resultType="Long">
  SELECT
      IFNULL(count(*), 0) AS un
      readcount
  FROM
      t_cm_agent_message
  WHERE
      touserid = #{touserid}
  AND STATUS = 0
  </select>


  <select id="countUnreadMessageByToUserIdGroupByFromUserId" parameterType="String" resultType="Map">
  SELECT
      fromuserid,
      (select count(*) from t_cm_agent_message where touserid = a.touserid and STATUS = 0 and fromuserid = a.fromuserid ) as unreadcount
  FROM
      t_cm_agent_message a
  WHERE
      touserid = #{touserid}
      AND createtime &gt; date_sub(now(),interval 7 day)
  GROUP BY
      fromuserid
  </select>

    <select id="queryHistoryMessage" parameterType="String" resultType="cn.jufangbao.house.shhouse.model.TCmAgentMessage">
    SELECT
        *
    FROM
        t_cm_agent_message
    WHERE
        (
            toUserId = #{touserid}
            OR fromUserId = #{touserid}
        )
    AND (
        toUserId = #{fromuserid}
        OR fromUserId = #{fromuserid}
    )
    AND createtime &gt; date_sub(now(), INTERVAL 7 DAY)
    ORDER BY
        createTime DESC
    </select>
</mapper>